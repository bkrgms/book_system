{"ast":null,"code":"\"use strict\";\n\n/*\n * Copyright 2019 gRPC authors.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n *\n */\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.QueuePicker = exports.UnavailablePicker = exports.PickResultType = void 0;\nconst metadata_1 = require(\"./metadata\");\nconst constants_1 = require(\"./constants\");\nvar PickResultType;\n(function (PickResultType) {\n  PickResultType[PickResultType[\"COMPLETE\"] = 0] = \"COMPLETE\";\n  PickResultType[PickResultType[\"QUEUE\"] = 1] = \"QUEUE\";\n  PickResultType[PickResultType[\"TRANSIENT_FAILURE\"] = 2] = \"TRANSIENT_FAILURE\";\n  PickResultType[PickResultType[\"DROP\"] = 3] = \"DROP\";\n})(PickResultType || (exports.PickResultType = PickResultType = {}));\n/**\n * A standard picker representing a load balancer in the TRANSIENT_FAILURE\n * state. Always responds to every pick request with an UNAVAILABLE status.\n */\nclass UnavailablePicker {\n  constructor(status) {\n    this.status = Object.assign({\n      code: constants_1.Status.UNAVAILABLE,\n      details: 'No connection established',\n      metadata: new metadata_1.Metadata()\n    }, status);\n  }\n  pick(pickArgs) {\n    return {\n      pickResultType: PickResultType.TRANSIENT_FAILURE,\n      subchannel: null,\n      status: this.status,\n      onCallStarted: null,\n      onCallEnded: null\n    };\n  }\n}\nexports.UnavailablePicker = UnavailablePicker;\n/**\n * A standard picker representing a load balancer in the IDLE or CONNECTING\n * state. Always responds to every pick request with a QUEUE pick result\n * indicating that the pick should be tried again with the next `Picker`. Also\n * reports back to the load balancer that a connection should be established\n * once any pick is attempted.\n * If the childPicker is provided, delegate to it instead of returning the\n * hardcoded QUEUE pick result, but still calls exitIdle.\n */\nclass QueuePicker {\n  // Constructed with a load balancer. Calls exitIdle on it the first time pick is called\n  constructor(loadBalancer, childPicker) {\n    this.loadBalancer = loadBalancer;\n    this.childPicker = childPicker;\n    this.calledExitIdle = false;\n  }\n  pick(pickArgs) {\n    if (!this.calledExitIdle) {\n      process.nextTick(() => {\n        this.loadBalancer.exitIdle();\n      });\n      this.calledExitIdle = true;\n    }\n    if (this.childPicker) {\n      return this.childPicker.pick(pickArgs);\n    } else {\n      return {\n        pickResultType: PickResultType.QUEUE,\n        subchannel: null,\n        status: null,\n        onCallStarted: null,\n        onCallEnded: null\n      };\n    }\n  }\n}\nexports.QueuePicker = QueuePicker;","map":{"version":3,"names":["metadata_1","require","constants_1","PickResultType","exports","UnavailablePicker","constructor","status","Object","assign","code","Status","UNAVAILABLE","details","metadata","Metadata","pick","pickArgs","pickResultType","TRANSIENT_FAILURE","subchannel","onCallStarted","onCallEnded","QueuePicker","loadBalancer","childPicker","calledExitIdle","process","nextTick","exitIdle","QUEUE"],"sources":["../../src/picker.ts"],"sourcesContent":[null],"mappings":";;AAAA;;;;;;;;;;;;;;;;;;;;AAkBA,MAAAA,UAAA,GAAAC,OAAA;AACA,MAAAC,WAAA,GAAAD,OAAA;AAIA,IAAYE,cAKX;AALD,WAAYA,cAAc;EACxBA,cAAA,CAAAA,cAAA,8BAAQ;EACRA,cAAA,CAAAA,cAAA,wBAAK;EACLA,cAAA,CAAAA,cAAA,gDAAiB;EACjBA,cAAA,CAAAA,cAAA,sBAAI;AACN,CAAC,EALWA,cAAc,KAAAC,OAAA,CAAAD,cAAA,GAAdA,cAAc;AAsE1B;;;;AAIA,MAAaE,iBAAiB;EAE5BC,YAAYC,MAA8B;IACxC,IAAI,CAACA,MAAM,GAAAC,MAAA,CAAAC,MAAA;MACTC,IAAI,EAAER,WAAA,CAAAS,MAAM,CAACC,WAAW;MACxBC,OAAO,EAAE,2BAA2B;MACpCC,QAAQ,EAAE,IAAId,UAAA,CAAAe,QAAQ;IAAE,GACrBR,MAAM,CACV;EACH;EACAS,IAAIA,CAACC,QAAkB;IACrB,OAAO;MACLC,cAAc,EAAEf,cAAc,CAACgB,iBAAiB;MAChDC,UAAU,EAAE,IAAI;MAChBb,MAAM,EAAE,IAAI,CAACA,MAAM;MACnBc,aAAa,EAAE,IAAI;MACnBC,WAAW,EAAE;KACd;EACH;;AAlBFlB,OAAA,CAAAC,iBAAA,GAAAA,iBAAA;AAqBA;;;;;;;;;AASA,MAAakB,WAAW;EAEtB;EACAjB,YACUkB,YAA0B,EAC1BC,WAAoB;IADpB,KAAAD,YAAY,GAAZA,YAAY;IACZ,KAAAC,WAAW,GAAXA,WAAW;IAJb,KAAAC,cAAc,GAAG,KAAK;EAK3B;EAEHV,IAAIA,CAACC,QAAkB;IACrB,IAAI,CAAC,IAAI,CAACS,cAAc,EAAE;MACxBC,OAAO,CAACC,QAAQ,CAAC,MAAK;QACpB,IAAI,CAACJ,YAAY,CAACK,QAAQ,EAAE;MAC9B,CAAC,CAAC;MACF,IAAI,CAACH,cAAc,GAAG,IAAI;IAC5B;IACA,IAAI,IAAI,CAACD,WAAW,EAAE;MACpB,OAAO,IAAI,CAACA,WAAW,CAACT,IAAI,CAACC,QAAQ,CAAC;IACxC,CAAC,MAAM;MACL,OAAO;QACLC,cAAc,EAAEf,cAAc,CAAC2B,KAAK;QACpCV,UAAU,EAAE,IAAI;QAChBb,MAAM,EAAE,IAAI;QACZc,aAAa,EAAE,IAAI;QACnBC,WAAW,EAAE;OACd;IACH;EACF;;AA1BFlB,OAAA,CAAAmB,WAAA,GAAAA,WAAA","ignoreList":[]},"metadata":{},"sourceType":"script","externalDependencies":[]}