{"ast":null,"code":"\"use strict\";\n\n/*\n * Copyright 2022 gRPC authors.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n *\n */\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.InterceptingListenerImpl = exports.isInterceptingListener = void 0;\nfunction isInterceptingListener(listener) {\n  return listener.onReceiveMetadata !== undefined && listener.onReceiveMetadata.length === 1;\n}\nexports.isInterceptingListener = isInterceptingListener;\nclass InterceptingListenerImpl {\n  constructor(listener, nextListener) {\n    this.listener = listener;\n    this.nextListener = nextListener;\n    this.processingMetadata = false;\n    this.hasPendingMessage = false;\n    this.processingMessage = false;\n    this.pendingStatus = null;\n  }\n  processPendingMessage() {\n    if (this.hasPendingMessage) {\n      this.nextListener.onReceiveMessage(this.pendingMessage);\n      this.pendingMessage = null;\n      this.hasPendingMessage = false;\n    }\n  }\n  processPendingStatus() {\n    if (this.pendingStatus) {\n      this.nextListener.onReceiveStatus(this.pendingStatus);\n    }\n  }\n  onReceiveMetadata(metadata) {\n    this.processingMetadata = true;\n    this.listener.onReceiveMetadata(metadata, metadata => {\n      this.processingMetadata = false;\n      this.nextListener.onReceiveMetadata(metadata);\n      this.processPendingMessage();\n      this.processPendingStatus();\n    });\n  }\n  // eslint-disable-next-line @typescript-eslint/no-explicit-any\n  onReceiveMessage(message) {\n    /* If this listener processes messages asynchronously, the last message may\n     * be reordered with respect to the status */\n    this.processingMessage = true;\n    this.listener.onReceiveMessage(message, msg => {\n      this.processingMessage = false;\n      if (this.processingMetadata) {\n        this.pendingMessage = msg;\n        this.hasPendingMessage = true;\n      } else {\n        this.nextListener.onReceiveMessage(msg);\n        this.processPendingStatus();\n      }\n    });\n  }\n  onReceiveStatus(status) {\n    this.listener.onReceiveStatus(status, processedStatus => {\n      if (this.processingMetadata || this.processingMessage) {\n        this.pendingStatus = processedStatus;\n      } else {\n        this.nextListener.onReceiveStatus(processedStatus);\n      }\n    });\n  }\n}\nexports.InterceptingListenerImpl = InterceptingListenerImpl;","map":{"version":3,"names":["isInterceptingListener","listener","onReceiveMetadata","undefined","length","exports","InterceptingListenerImpl","constructor","nextListener","processingMetadata","hasPendingMessage","processingMessage","pendingStatus","processPendingMessage","onReceiveMessage","pendingMessage","processPendingStatus","onReceiveStatus","metadata","message","msg","status","processedStatus"],"sources":["../../src/call-interface.ts"],"sourcesContent":[null],"mappings":";;AAAA;;;;;;;;;;;;;;;;;;;;AAoFA,SAAgBA,sBAAsBA,CACpCC,QAAyC;EAEzC,OACEA,QAAQ,CAACC,iBAAiB,KAAKC,SAAS,IACxCF,QAAQ,CAACC,iBAAiB,CAACE,MAAM,KAAK,CAAC;AAE3C;AAPAC,OAAA,CAAAL,sBAAA,GAAAA,sBAAA;AASA,MAAaM,wBAAwB;EAMnCC,YACUN,QAAsB,EACtBO,YAAkC;IADlC,KAAAP,QAAQ,GAARA,QAAQ;IACR,KAAAO,YAAY,GAAZA,YAAY;IAPd,KAAAC,kBAAkB,GAAG,KAAK;IAC1B,KAAAC,iBAAiB,GAAG,KAAK;IAEzB,KAAAC,iBAAiB,GAAG,KAAK;IACzB,KAAAC,aAAa,GAAwB,IAAI;EAI9C;EAEKC,qBAAqBA,CAAA;IAC3B,IAAI,IAAI,CAACH,iBAAiB,EAAE;MAC1B,IAAI,CAACF,YAAY,CAACM,gBAAgB,CAAC,IAAI,CAACC,cAAc,CAAC;MACvD,IAAI,CAACA,cAAc,GAAG,IAAI;MAC1B,IAAI,CAACL,iBAAiB,GAAG,KAAK;IAChC;EACF;EAEQM,oBAAoBA,CAAA;IAC1B,IAAI,IAAI,CAACJ,aAAa,EAAE;MACtB,IAAI,CAACJ,YAAY,CAACS,eAAe,CAAC,IAAI,CAACL,aAAa,CAAC;IACvD;EACF;EAEAV,iBAAiBA,CAACgB,QAAkB;IAClC,IAAI,CAACT,kBAAkB,GAAG,IAAI;IAC9B,IAAI,CAACR,QAAQ,CAACC,iBAAiB,CAACgB,QAAQ,EAAEA,QAAQ,IAAG;MACnD,IAAI,CAACT,kBAAkB,GAAG,KAAK;MAC/B,IAAI,CAACD,YAAY,CAACN,iBAAiB,CAACgB,QAAQ,CAAC;MAC7C,IAAI,CAACL,qBAAqB,EAAE;MAC5B,IAAI,CAACG,oBAAoB,EAAE;IAC7B,CAAC,CAAC;EACJ;EACA;EACAF,gBAAgBA,CAACK,OAAY;IAC3B;;IAEA,IAAI,CAACR,iBAAiB,GAAG,IAAI;IAC7B,IAAI,CAACV,QAAQ,CAACa,gBAAgB,CAACK,OAAO,EAAEC,GAAG,IAAG;MAC5C,IAAI,CAACT,iBAAiB,GAAG,KAAK;MAC9B,IAAI,IAAI,CAACF,kBAAkB,EAAE;QAC3B,IAAI,CAACM,cAAc,GAAGK,GAAG;QACzB,IAAI,CAACV,iBAAiB,GAAG,IAAI;MAC/B,CAAC,MAAM;QACL,IAAI,CAACF,YAAY,CAACM,gBAAgB,CAACM,GAAG,CAAC;QACvC,IAAI,CAACJ,oBAAoB,EAAE;MAC7B;IACF,CAAC,CAAC;EACJ;EACAC,eAAeA,CAACI,MAAoB;IAClC,IAAI,CAACpB,QAAQ,CAACgB,eAAe,CAACI,MAAM,EAAEC,eAAe,IAAG;MACtD,IAAI,IAAI,CAACb,kBAAkB,IAAI,IAAI,CAACE,iBAAiB,EAAE;QACrD,IAAI,CAACC,aAAa,GAAGU,eAAe;MACtC,CAAC,MAAM;QACL,IAAI,CAACd,YAAY,CAACS,eAAe,CAACK,eAAe,CAAC;MACpD;IACF,CAAC,CAAC;EACJ;;AA1DFjB,OAAA,CAAAC,wBAAA,GAAAA,wBAAA","ignoreList":[]},"metadata":{},"sourceType":"script","externalDependencies":[]}