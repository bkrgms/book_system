{"ast":null,"code":"\"use strict\";\n\n/*\n * Copyright 2019 gRPC authors.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n *\n */\nrequire(\"core-js/modules/es.array.push.js\");\nrequire(\"core-js/modules/es.set.difference.v2.js\");\nrequire(\"core-js/modules/es.set.intersection.v2.js\");\nrequire(\"core-js/modules/es.set.is-disjoint-from.v2.js\");\nrequire(\"core-js/modules/es.set.is-subset-of.v2.js\");\nrequire(\"core-js/modules/es.set.is-superset-of.v2.js\");\nrequire(\"core-js/modules/es.set.symmetric-difference.v2.js\");\nrequire(\"core-js/modules/es.set.union.v2.js\");\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.createServerCredentialsWithInterceptors = exports.createCertificateProviderServerCredentials = exports.ServerCredentials = void 0;\nconst tls_helpers_1 = require(\"./tls-helpers\");\nclass ServerCredentials {\n  constructor() {\n    this.watchers = new Set();\n    this.latestContextOptions = null;\n  }\n  _addWatcher(watcher) {\n    this.watchers.add(watcher);\n  }\n  _removeWatcher(watcher) {\n    this.watchers.delete(watcher);\n  }\n  getWatcherCount() {\n    return this.watchers.size;\n  }\n  updateSecureContextOptions(options) {\n    this.latestContextOptions = options;\n    for (const watcher of this.watchers) {\n      watcher(this.latestContextOptions);\n    }\n  }\n  _getSettings() {\n    return this.latestContextOptions;\n  }\n  _getInterceptors() {\n    return [];\n  }\n  static createInsecure() {\n    return new InsecureServerCredentials();\n  }\n  static createSsl(rootCerts, keyCertPairs, checkClientCertificate = false) {\n    var _a;\n    if (rootCerts !== null && !Buffer.isBuffer(rootCerts)) {\n      throw new TypeError('rootCerts must be null or a Buffer');\n    }\n    if (!Array.isArray(keyCertPairs)) {\n      throw new TypeError('keyCertPairs must be an array');\n    }\n    if (typeof checkClientCertificate !== 'boolean') {\n      throw new TypeError('checkClientCertificate must be a boolean');\n    }\n    const cert = [];\n    const key = [];\n    for (let i = 0; i < keyCertPairs.length; i++) {\n      const pair = keyCertPairs[i];\n      if (pair === null || typeof pair !== 'object') {\n        throw new TypeError(`keyCertPair[${i}] must be an object`);\n      }\n      if (!Buffer.isBuffer(pair.private_key)) {\n        throw new TypeError(`keyCertPair[${i}].private_key must be a Buffer`);\n      }\n      if (!Buffer.isBuffer(pair.cert_chain)) {\n        throw new TypeError(`keyCertPair[${i}].cert_chain must be a Buffer`);\n      }\n      cert.push(pair.cert_chain);\n      key.push(pair.private_key);\n    }\n    return new SecureServerCredentials({\n      ca: (_a = rootCerts !== null && rootCerts !== void 0 ? rootCerts : (0, tls_helpers_1.getDefaultRootsData)()) !== null && _a !== void 0 ? _a : undefined,\n      cert,\n      key,\n      requestCert: checkClientCertificate,\n      ciphers: tls_helpers_1.CIPHER_SUITES\n    });\n  }\n}\nexports.ServerCredentials = ServerCredentials;\nclass InsecureServerCredentials extends ServerCredentials {\n  _isSecure() {\n    return false;\n  }\n  _getSettings() {\n    return null;\n  }\n  _equals(other) {\n    return other instanceof InsecureServerCredentials;\n  }\n}\nclass SecureServerCredentials extends ServerCredentials {\n  constructor(options) {\n    super();\n    this.options = options;\n  }\n  _isSecure() {\n    return true;\n  }\n  _getSettings() {\n    return this.options;\n  }\n  /**\n   * Checks equality by checking the options that are actually set by\n   * createSsl.\n   * @param other\n   * @returns\n   */\n  _equals(other) {\n    if (this === other) {\n      return true;\n    }\n    if (!(other instanceof SecureServerCredentials)) {\n      return false;\n    }\n    // options.ca equality check\n    if (Buffer.isBuffer(this.options.ca) && Buffer.isBuffer(other.options.ca)) {\n      if (!this.options.ca.equals(other.options.ca)) {\n        return false;\n      }\n    } else {\n      if (this.options.ca !== other.options.ca) {\n        return false;\n      }\n    }\n    // options.cert equality check\n    if (Array.isArray(this.options.cert) && Array.isArray(other.options.cert)) {\n      if (this.options.cert.length !== other.options.cert.length) {\n        return false;\n      }\n      for (let i = 0; i < this.options.cert.length; i++) {\n        const thisCert = this.options.cert[i];\n        const otherCert = other.options.cert[i];\n        if (Buffer.isBuffer(thisCert) && Buffer.isBuffer(otherCert)) {\n          if (!thisCert.equals(otherCert)) {\n            return false;\n          }\n        } else {\n          if (thisCert !== otherCert) {\n            return false;\n          }\n        }\n      }\n    } else {\n      if (this.options.cert !== other.options.cert) {\n        return false;\n      }\n    }\n    // options.key equality check\n    if (Array.isArray(this.options.key) && Array.isArray(other.options.key)) {\n      if (this.options.key.length !== other.options.key.length) {\n        return false;\n      }\n      for (let i = 0; i < this.options.key.length; i++) {\n        const thisKey = this.options.key[i];\n        const otherKey = other.options.key[i];\n        if (Buffer.isBuffer(thisKey) && Buffer.isBuffer(otherKey)) {\n          if (!thisKey.equals(otherKey)) {\n            return false;\n          }\n        } else {\n          if (thisKey !== otherKey) {\n            return false;\n          }\n        }\n      }\n    } else {\n      if (this.options.key !== other.options.key) {\n        return false;\n      }\n    }\n    // options.requestCert equality check\n    if (this.options.requestCert !== other.options.requestCert) {\n      return false;\n    }\n    /* ciphers is derived from a value that is constant for the process, so no\n     * equality check is needed. */\n    return true;\n  }\n}\nclass CertificateProviderServerCredentials extends ServerCredentials {\n  constructor(identityCertificateProvider, caCertificateProvider, requireClientCertificate) {\n    super();\n    this.identityCertificateProvider = identityCertificateProvider;\n    this.caCertificateProvider = caCertificateProvider;\n    this.requireClientCertificate = requireClientCertificate;\n    this.latestCaUpdate = null;\n    this.latestIdentityUpdate = null;\n    this.caCertificateUpdateListener = this.handleCaCertificateUpdate.bind(this);\n    this.identityCertificateUpdateListener = this.handleIdentityCertitificateUpdate.bind(this);\n  }\n  _addWatcher(watcher) {\n    var _a;\n    if (this.getWatcherCount() === 0) {\n      (_a = this.caCertificateProvider) === null || _a === void 0 ? void 0 : _a.addCaCertificateListener(this.caCertificateUpdateListener);\n      this.identityCertificateProvider.addIdentityCertificateListener(this.identityCertificateUpdateListener);\n    }\n    super._addWatcher(watcher);\n  }\n  _removeWatcher(watcher) {\n    var _a;\n    super._removeWatcher(watcher);\n    if (this.getWatcherCount() === 0) {\n      (_a = this.caCertificateProvider) === null || _a === void 0 ? void 0 : _a.removeCaCertificateListener(this.caCertificateUpdateListener);\n      this.identityCertificateProvider.removeIdentityCertificateListener(this.identityCertificateUpdateListener);\n    }\n  }\n  _isSecure() {\n    return true;\n  }\n  _equals(other) {\n    if (this === other) {\n      return true;\n    }\n    if (!(other instanceof CertificateProviderServerCredentials)) {\n      return false;\n    }\n    return this.caCertificateProvider === other.caCertificateProvider && this.identityCertificateProvider === other.identityCertificateProvider && this.requireClientCertificate === other.requireClientCertificate;\n  }\n  calculateSecureContextOptions() {\n    var _a;\n    if (this.latestIdentityUpdate === null) {\n      return null;\n    }\n    if (this.caCertificateProvider !== null && this.latestCaUpdate === null) {\n      return null;\n    }\n    return {\n      ca: (_a = this.latestCaUpdate) === null || _a === void 0 ? void 0 : _a.caCertificate,\n      cert: this.latestIdentityUpdate.certificate,\n      key: this.latestIdentityUpdate.privateKey,\n      requestCert: this.latestIdentityUpdate !== null,\n      rejectUnauthorized: this.requireClientCertificate\n    };\n  }\n  finalizeUpdate() {\n    this.updateSecureContextOptions(this.calculateSecureContextOptions());\n  }\n  handleCaCertificateUpdate(update) {\n    this.latestCaUpdate = update;\n    this.finalizeUpdate();\n  }\n  handleIdentityCertitificateUpdate(update) {\n    this.latestIdentityUpdate = update;\n    this.finalizeUpdate();\n  }\n}\nfunction createCertificateProviderServerCredentials(caCertificateProvider, identityCertificateProvider, requireClientCertificate) {\n  return new CertificateProviderServerCredentials(caCertificateProvider, identityCertificateProvider, requireClientCertificate);\n}\nexports.createCertificateProviderServerCredentials = createCertificateProviderServerCredentials;\nclass InterceptorServerCredentials extends ServerCredentials {\n  constructor(childCredentials, interceptors) {\n    super();\n    this.childCredentials = childCredentials;\n    this.interceptors = interceptors;\n  }\n  _isSecure() {\n    return this.childCredentials._isSecure();\n  }\n  _equals(other) {\n    if (!(other instanceof InterceptorServerCredentials)) {\n      return false;\n    }\n    if (!this.childCredentials._equals(other.childCredentials)) {\n      return false;\n    }\n    if (this.interceptors.length !== other.interceptors.length) {\n      return false;\n    }\n    for (let i = 0; i < this.interceptors.length; i++) {\n      if (this.interceptors[i] !== other.interceptors[i]) {\n        return false;\n      }\n    }\n    return true;\n  }\n  _getInterceptors() {\n    return this.interceptors;\n  }\n  _addWatcher(watcher) {\n    this.childCredentials._addWatcher(watcher);\n  }\n  _removeWatcher(watcher) {\n    this.childCredentials._removeWatcher(watcher);\n  }\n}\nfunction createServerCredentialsWithInterceptors(credentials, interceptors) {\n  return new InterceptorServerCredentials(credentials, interceptors);\n}\nexports.createServerCredentialsWithInterceptors = createServerCredentialsWithInterceptors;","map":{"version":3,"names":["require","tls_helpers_1","ServerCredentials","constructor","watchers","Set","latestContextOptions","_addWatcher","watcher","add","_removeWatcher","delete","getWatcherCount","size","updateSecureContextOptions","options","_getSettings","_getInterceptors","createInsecure","InsecureServerCredentials","createSsl","rootCerts","keyCertPairs","checkClientCertificate","Buffer","isBuffer","TypeError","Array","isArray","cert","key","i","length","pair","private_key","cert_chain","push","SecureServerCredentials","ca","_a","getDefaultRootsData","undefined","requestCert","ciphers","CIPHER_SUITES","exports","_isSecure","_equals","other","equals","thisCert","otherCert","thisKey","otherKey","CertificateProviderServerCredentials","identityCertificateProvider","caCertificateProvider","requireClientCertificate","latestCaUpdate","latestIdentityUpdate","caCertificateUpdateListener","handleCaCertificateUpdate","bind","identityCertificateUpdateListener","handleIdentityCertitificateUpdate","addCaCertificateListener","addIdentityCertificateListener","removeCaCertificateListener","removeIdentityCertificateListener","calculateSecureContextOptions","caCertificate","certificate","privateKey","rejectUnauthorized","finalizeUpdate","update","createCertificateProviderServerCredentials","InterceptorServerCredentials","childCredentials","interceptors","createServerCredentialsWithInterceptors","credentials"],"sources":["../../src/server-credentials.ts"],"sourcesContent":[null],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"script","externalDependencies":[]}